{% extends 'sender/base.html' %}

{% block content %}
    {% load static %}
    {% load sender_filters %}

<div class="container my-5">
    <div class="row">
        <div class="col-lg-12 col-xl-1 col-md-12 col-sm-12 col-12">
        </div>
        {% if not object_list %}
        <div class="col-lg-8 col-xl-8 col-md-12 col-sm-12 col-12 mb-3">
            <h5 class="lead">
                <strong>У Вас пока нет рассылок. Вы можете создать рассылки с периодичностью отправки ежедневно,
                раз в неделю, раз в месяц, добавлять к ним письма, и отслеживать, насколько успешно происходит рассылка</strong>
            </h5>
        </div>
        {% elif object_list %}
        <div class="col-lg-8 col-xl-8 col-md-12 col-sm-12 col-12">
            <table class="table table-info">
                <thead>
                    <tr>
                        <th class="col-3" scope="col">Название</th>
                        <th class="col-3" scope="col">График</th>
                        <th class="col-6" scope="col">Готовность</th>
                        <th class="col-1" scope="col"></th>
                    </tr>
                </thead>
                <tbody>
                {% for object in object_list %}
                    <tr class="{% if object.status == 'Завершена' %}table-success
                                {% elif object.periodicity == 'Один/несколько дней в неделю' and not object.weekday %}table-danger
                                {% elif object.periodicity == 'Один/несколько дней в месяц' and not object.monthdate %}table-danger
                                {% elif not object.mail_dump %}table-danger
                        {% endif %}">
                        <td><a href="{{ object.get_absolute_url }}">{{ object.title | slice:30 }}</a></td>
                        <td>{{ object.periodicity }}</td>
                        <td>{% if object.status == 'Завершена' %}Рассылка завершена
                            {% elif object.periodicity == 'Один/несколько дней в неделю' and not object.weekday %} Добавьте дни недели рассылки!
                            {% elif object.periodicity == 'Один/несколько дней в месяц' and not object.monthdate %} Добавьте даты месяца рассылки!
                            {% elif not object.mail_dump %} Загрузите базу мейлов!
                            {% else %} Готово к работе! <br> <strong>Email рассылки: </strong>{{ object.from_email }}
                            <a class="update-mailing-profile" href="{% url 'sender:update_mailing' object.pk %}"><br> Изменить email</a>
                            {% endif %}</td>
                        <td>
                            <a href="{% url 'sender:mailing_detail' object.pk %}" style="text-decoration: unset">
                                <img class="mb-2" src="{% static "img/goto.png" %}" title="Перейти на страницу рассылки">
                            </a>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
        <div class="col-lg-4 col-xl-3 col-md-12 col-sm-12">
            <div class="row">
                <div class="col-md-3 col-lg-12 col-sm-12 col-xl-12">
                </div>
                <div class="col-lg-12 col-xl-12 col-md-6 col-sm-12 text-center my-0">
                    <div class="card mb-5 box-shadow border-dark border-2">
                        <div class="card-header bg-success">
                            <h4 class="my-0 font-weight-normal text-white">Создать новую рассылку</h4>
                        </div>
                        <form method="post" action="" class="form-floating" enctype="multipart/form-data">
                             <div class="card-body">
                                {% csrf_token %}
                                <div class="mb-3">
                                    <label for="id_title">{{ form.title.label }}</label>
                                    <input type="text" class="form-control form-control-sm" name="title" maxlength="200" required="" id="id_title">
                                    <div class="form-error text-danger">{{  form.title.errors | format_err }}</div>
                                </div>
                                <div class="mb-3">
                                    <div class="row">
                                        <div class="col-6">
                                            <label for="id_hour">Час</label>
                                            <select name="hour" class="form-control form-control-sm" id="id_hour">
                                                <option value="12" selected="">12</option>
                                            {% for hour in hours %}
                                                <option value="{{ hour }}">{{ hour }}</option>
                                            {% endfor %}
                                            </select>
                                        </div>
                                        <div class="col-6">
                                            <label for="id_minute">Минуты</label>
                                            <select name="minute" class="form-control form-control-sm" id="id_minute">
                                                {% for minute in minutes %}
                                                    {% if minute < 10 %}
                                                    <option value="{{ minute }}">0{{ minute }}</option>
                                                    {% else %}
                                                    <option value="{{ minute }}">{{ minute }}</option>
                                                    {% endif %}
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="id_periodicity">{{ form.periodicity.label }}</label>
                                        <select name="periodicity" class="form-control form-control-sm" id="id_periodicity">
                                        {% for period in periods %}
                                            {% if forloop.first %}
                                                <option value="{{ period|cut:"'" }}" selected="">{{ period|cut:"'" }}</option>
                                            {% else %}
                                                <option value="{{ period|cut:"'" }}">{{ period|cut:"'" }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                    <div class="form-error text-danger">{{  form.periodicity.errors|format_err }}</div>
                                </div>
                                <div class="mb-3">
                                     <label for="id_mail_dump">База рассылки</label>
                                    <input type="file" class="form-control form-control-sm" name="mail_dump" id="id_mail_dump">
                                    <div class="form-error text-danger">{{  form.mail_dump.errors|format_err }}</div>
                                </div>
                            </div>
                            <div class="card-footer bg-transparent border-0 px-0">
                                <button type="submit" class="btn btn-outline-primary w-50 mb-3"><strong>Отправить</strong></button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}